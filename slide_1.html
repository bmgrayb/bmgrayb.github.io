<!doctype html>
<html lang="en">
    <script src='https://d3js.org/d3.v5.min.js'></script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
 
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">

    <title>Covid-19 Data</title>
  </head>
  <body>

    <nav aria-label="Page navigation example">
        <ul class="pagination justify-content-center pagination-lg">
            <li class="page-item"><a class="page-link" href="index.html">Previous</a></li>
            <li class="page-item active"><a class="page-link" href="slide_1.html">1</a></li>
          <li class="page-item"><a class="page-link" href="slide_2.html">2</a></li>
          <li class="page-item"><a class="page-link" href="slide_3.html">3</a></li>
          <li class="page-item"><a class="page-link" href="slide_2.html">Next</a></li>
        </ul>
      </nav>

      <div id="slide1">
        <script>
            async function init() {

                //variables
                var margin = {top: 10, right: 30, bottom: 30, left: 300},
                width = 1500 - margin.left - margin.right,
                height = 500 - margin.top - margin.bottom;
                function getDate(d) {
                    return new Date(d);
                }

                //read in data
                const temp = await d3.csv("https://raw.githubusercontent.com/bmgrayb/bmgrayb.github.io/master/data/world-processed.csv");
                data = temp

                // append the svg object to the body of the page
                var svg = d3.select("#slide1")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

                //set up data keys
                var states = d3.nest()
                .key(function(d) { return d.location;})
                .entries(data);

                //set up axis
                var maxDate = d3.max(data, function(d) { return getDate(d.date); } );
                var minDate = d3.min(data, function(d) { return getDate(d.date); } );
                var x = d3.scaleTime().domain([minDate, maxDate]).range([0, width]);
                svg.append("g").attr("transform", "translate(0," + height + ")").call(d3.axisBottom(x).ticks(8));
                var y = d3.scaleLinear().domain([0, 80000]).range([ height, 0 ]);
                svg.append("g").call(d3.axisLeft(y));

                //get scale for color
                var res = states.map(function(d){ return d.key }) // list of group names
                var color = d3.scaleOrdinal().domain(res).range(d3.schemeCategory10);

                ///////////////////////////////////////////////////////////////////////
                //tooltip functions
                const tooltip = d3.select('#tooltip');
                const tooltipLine = svg.append('line');
                function removeTooltip() {
                    if (tooltip) tooltip.style('display', 'none');
                    if (tooltipLine) tooltipLine.attr('stroke', 'none');
                }
                function drawTooltip() {
                    var mouse = d3.mouse(this);
                    const date = x.invert(mouse[0]);

                    tooltipLine.attr('stroke', 'black')
                        .attr('x1', function(d) { return x(date); })
                        .attr('x2', function(d) { return x(date); })
                        .attr('y1', 0)
                        .attr('y2', height);
                    
                    tooltip.html(date)
                        .style('display', 'block')
                        .style('left', d3.event.pageX + 20)
                        .style('top', d3.event.pageY - 20)
                        .selectAll()
                        .data(states).enter()
                        .append('div')
                        .style('color', function(d){ return color(d.key); })
                        .html(function(d){
                            var curr = d.values.filter(v => v.date == date.toISOString().slice(0,10));
                            return d.key + ': ' + curr[0].new_cases;
                        });
                }
                ///////////////////////////////////////////////////////////////////////

                //line chart
                svg.selectAll(".line")
                .data(states)
                .enter()
                .append("path")
                .attr("fill", "none")
                .attr("stroke", function(d){ return color(d.key) })
                .attr("stroke-width", 1.5)
                .attr("d", function(d){
                    return d3.line()
                    .x(function(d) { return x(getDate(d.date)); })
                    .y(function(d) { return y(d.new_cases); })
                (d.values)});

                console.log(states.map(m => m.key))

                svg.selectAll()
                .data(states)
                .enter()
                .append('text')
                .html(function(d){ return d.key; })
                .attr('fill', function(d){ return color(d.key); })
                .attr('alignment-baseline', 'middle')
                .attr('x', width)
                .attr('dx', '0.5em')
                .attr('y', function(d) { 
                    var curr = d.values.filter(v => v.date == maxDate.toISOString().slice(0,10));
                    return y(curr[0].new_cases); 
                }); 
                
                var tipBox = svg.append('rect')
                .attr('width', width)
                .attr('height', height)
                .attr('opacity', 0)
                .on('mousemove', drawTooltip)
                .on('mouseout', removeTooltip);
            }

            init()

        </script>
    </div>

    <br/><br/>

    <h3>Messaging</h3>
    <p>What is the message you are trying to communicate with the narrative visualization? </p>

    <h3>Narrative Structure. </h3>
    <p>Which structure was your narrative visualization designed to follow (martini glass, interactive slide show or drop-down story)? How does your narrative visualization follow that structure? (All of these structures can include the opportunity to "drill-down" and explore. The difference is where that opportunity happens in the structure.)
    </p>

    <h3>Visual Structure.</h3>
    <p>What visual structure is used for each scene? How does it ensure the viewer can understand the data and navigate the scene? How does it highlight to urge the viewer to focus on the important parts of the data in each scene? How does it help the viewer transition to other scenes, to understand how the data connects to the data in other scenes?
    </p>

    <h3>Scenes. </h3>
    <p>What are the scenes of your narrative visualization? How are the scenes ordered, and why
    </p>
    
    <h3>Annotations. </h3>
    <p> What template was followed for the annotations, and why that template? How are the annotations used to support the messaging? Do the annotations change within a single scene, and if so, how and why
    </p>

    <h3>Parameters. </h3>
    <p>What are the parameters of the narrative visualization? What are the states of the narrative visualization? How are the parameters used to define the state and each scene?
    </p>

    <h3>Triggers. </h3>
    <p>What are the triggers that connect user actions to changes of state in the narrative visualization? What affordances are provided to the user to communicate to them what options are available to them in the narrative visualization?
    </p>

</body>
</html>